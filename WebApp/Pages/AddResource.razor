@page "/workloads/{workloadId:int}/add-resource"
@using Shared.Models
@using WebApp.Services

@inject WorkloadService WorkloadService
@inject NavigationManager Navigation

<h3>Add Resource</h3>

<EditForm Model="newResource" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3">
        <label for="name" class="form-label">Name</label>
        <InputText id="name" class="form-control" @bind-Value="newResource.Name" />
    </div>
    <div class="mb-3">
        <label for="resourceType" class="form-label">Resource Type</label>
        <InputText id="resourceType" class="form-control" @bind-Value="newResource.ResourceType.Name" />
    </div>

    <button type="submit" class="btn btn-primary">Add Resource</button>
    <button type="button" class="btn btn-secondary" @onclick="NavigateBack">Cancel</button>
</EditForm>

@code {
    [Parameter] public int WorkloadId { get; set; }
    private Resource newResource = new Resource
    {
        Name = "",
        Workload = new Workload
        {
            Name = "",
            AzureNamePrefix = ""
        },
        WorkloadEnvironmentRegion = new WorkloadEnvironmentRegion
        {
            Workload = new Workload
            {
                Name = "",
                AzureNamePrefix = ""
            },
            EnvironmentType = new EnvironmentType
            {
                Name = ""
            },
            Region = new AzureRegion
            {
                Name = "",
                Code = ""
            }
        },
        ResourceType = new ResourceType
        {
            Name = "",
            AzureResourceType = ""
        },
        Status = new ResourceStatus
        {
            Name = ""
        }
    };

    private async Task HandleValidSubmit()
    {
        await WorkloadService.AddResourceToWorkloadAsync(WorkloadId, newResource);
        Navigation.NavigateTo($"/workloads");
    }

    private void NavigateBack()
    {
        Navigation.NavigateTo($"/workloads");
    }
}